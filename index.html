<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

    <!-- Search City  -->
    <form id="searchCity">
        <label for="search-input">Search city</label>
        <input type="text" id="search-input">
        <br>

        <!-- Button triggers new City to be added -->
        <input id="add-city" type="submit" value="Search City">
    </form>

    <br>
    <!-- Rendered Buttons will get Dumped Here  -->
    <div id="list-group"></div>

    <!-- Events will get Dumped Here  -->
    <div id="event-list-group"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        // Initial array of City
        var cityArray = ["London", "Chicago", "Paris", "New York", "Boston"];
        localStorage.setItem('cityArray', JSON.stringify(cityArray));

        // displayCityInfo function re-renders the HTML to display the appropriate content
        function displayCityInfo() {

            var city = $(this).attr("city-name");
            console.log(city);
            //call the current weather fun
            console.log("Inside displaycityinfo-------------------");
            displayEventInfo(city);
        }


        // displayEventInfo function re-renders the HTML to display the appropriate content
        function displayEventInfo(city) {

            //console.log("Inside display Event info--------$$$$-----------");
            //var queryURL = "https://api.appnexus.com/dma?name="+city;

            //var corsAPI = "https://alex-rosencors.herokuapp.com/?url=" + queryURL;

            // Creating an AJAX call for the specific event button being clicked
            // $.ajax({
            //     url: queryURL,
            //     method: "GET"
            // }).then(function (response) {
            //     console.log(response);
            
            // });



            //var movie = $(this).attr("event-name");
            //var queryURL = "https://app.ticketmaster.com/discovery/v2/events?apikey=QW0RmyVGGiG8UHcQOKsmezCeVAoqIaPU&locale=en-us&dmaId=324";
            var queryURL = "https://app.ticketmaster.com/discovery/v2/events?apikey=QW0RmyVGGiG8UHcQOKsmezCeVAoqIaPU&city="+city;

            // Creating an AJAX call for the specific event button being clicked
            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function (response) {
                console.log(response);


                for (i=0; i< 5; i++) {
                // Creating a div to hold the event
                var eventDiv = $("<div class='event'>");

              //   console.log("1"+response._embedded);
              //  console.log(response._embedded);
                
                // console.log("2"+response._embedded._embedded);
                // console.log("2"+JSON.parse(response._embedded._embedded));

                //console.log(response._embedded.events);
                
                // console.log("4"+response._embedded._embedded.event[0].name);


                // Creating an element to have the rating displayed
                var pZero = $("<p>").text("Event");
                    //console.log(pZero);

                // Displaying the rating
                eventDiv.append(pZero);

                var pOne = $("<p>").text("          "+ response._embedded.events[i].name);
                    //console.log(pOne);

                // Displaying the rating
                eventDiv.append(pOne);

                var pTwo = $("<p>").text("          "+ response._embedded.events[i].dates.start.localDate);
                    //console.log(pTwo);

                // Displaying the rating
                eventDiv.append(pTwo);

                var pFinal = $("<BR>");
                     // Displaying the rating
                eventDiv.append(pFinal);

//   // Storing the release year
                //   var released = response.Released;

                //   // Creating an element to hold the release year
                //   var pTwo = $("<p>").text("Released: " + released);

                //   // Displaying the release year
                //   movieDiv.append(pTwo);

                //   // Storing the plot
                //   var plot = response.Plot;

                //   // Creating an element to hold the plot
                //   var pThree = $("<p>").text("Plot: " + plot);

                //   // Appending the plot
                //   movieDiv.append(pThree);

                //   // Retrieving the URL for the image
                //   var imgURL = response.Poster;

                //   // Creating an element to hold the image
                //   var image = $("<img>").attr("src", imgURL);

                //   // Appending the image
                //   movieDiv.append(image);

                // Putting the entire movie above the previous movies
                $("#event-list-group").prepend(eventDiv);
                }
            });

        }



        // Function for displaying city data
        function renderButtons() {

            var restoreCity = JSON.parse(localStorage.getItem('cityArray'));

            // Deleting the city prior to adding new cities
            // (this is necessary otherwise you will have repeat buttons)
            $("#list-group").empty();

            // Looping through the array of city
            for (var i = 0; i < restoreCity.length; i++) {

                // Then dynamicaly generating buttons for each city in the array
                // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
                var a = $("<button>");
                // Adding a class of city-btn to our button
                a.addClass("city-btn");
                // Adding a data-attribute
                a.attr("city-name", restoreCity[i]);
                // Providing the initial button text
                a.text(restoreCity[i]);
                // Adding the button to the list-group div
                $("#list-group").append(a);
            }
        }


        $("#add-city").on("click", function (event) {
            event.preventDefault();

            var restoreCity = JSON.parse(localStorage.getItem('cityArray'));

            // This line grabs the input from the textbox
            var city = $("#search-input").val().trim();

            // Adding movie from the textbox to our array
            restoreCity.push(city);

            localStorage.setItem('cityArray', JSON.stringify(restoreCity));

            // Calling renderButtons which handles the processing of our City array
            renderButtons();
        });


        // Adding a click event listener to all elements with a class of "list-group"
        $(document).on("click", ".city-btn", displayCityInfo);


        // Calling the renderButtons function to display the initial buttons
        renderButtons();

    </script>
</body>

</html>